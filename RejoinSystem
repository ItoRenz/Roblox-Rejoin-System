-- =============================================
-- Script Name: Roblox Rejoin System
-- Author: ItoRenz00
-- Description: Menyimpan dan mengembalikan posisi pemain saat rejoin
-- Date: 2025-11-14
-- =============================================

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")

-- Tabel untuk menyimpan posisi pemain
local playerPositions = {}

-- Fungsi untuk menyimpan posisi pemain saat ini
local function savePlayerPosition(player)
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        playerPositions[player.UserId] = character.HumanoidRootPart.CFrame
        print("[RejoinSystem] Posisi disimpan untuk " .. player.Name)
    end
end

-- Fungsi untuk membawa pemain ke posisi sebelumnya
local function teleportPlayerToSavedPosition(player)
    local savedCFrame = playerPositions[player.UserId]
    if savedCFrame then
        -- ⚠️ FIX: Gunakan Humanoid, bukan Player.RespawnTime
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp) -- Optional: force state
            end
        end

        wait(0.1)

        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = savedCFrame
            print("[RejoinSystem] Pemain " .. player.Name .. " dikembalikan ke posisi sebelumnya.")
        end
    end
end

-- Ketika pemain masuk kembali ke game
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        character:WaitForChild("HumanoidRootPart")
        wait(1) -- Tunggu sebentar agar spawn selesai
        teleportPlayerToSavedPosition(player)
    end)
end)

-- Fungsi untuk rejoin pemain
local function rejoinPlayer(player)
    savePlayerPosition(player)
    TeleportService:Teleport(game.PlaceId, player)
end

-- Contoh penggunaan: Perintah untuk rejoin saat pemain mengetik "!rejoin"
Players.PlayerAdded:Connect(function(player)
    player.Chatted:Connect(function(msg)
        if string.sub(msg, 1, 8) == "!rejoin" then
            rejoinPlayer(player)
        end
    end)
end)

print("[RejoinSystem] Script telah dimuat oleh Author: ItoRenz00")
